<?phpclass grupa_Controller extends Core_ModuleController{	public function __construct()	{		$this->modul = 'grupa';		parent::__construct();	}	//================================================================================	function indexAction(Core_Request $o_requestIn)	{		$o_indexResponse = new Core_Response();		$o_indexResponse->setModuleTemplate("lista");		$komunikaty = array();		$a_listaId  = $o_requestIn->getParametr('id');		if (is_array($a_listaId)) {			foreach ($a_listaId as $id) {				$rekord = new Model_Grupa($id);				$rekord->usun();				$komunikaty[] = array('ok', 'Rekord ' . $id . ' został usunięty.');			}		}		$na_strone = 10;		$strona = (int)$o_requestIn->getParametr('s');		$strona = max(1, $strona);		$sql         = "SELECT * FROM administratorzy_grupy";		$sql_records = $sql . ' LIMIT ' . ($na_strone * ($strona - 1)) . ', ' . (int)$na_strone . '';		$rekordy = $this->db->Execute($sql_records)->GetRows();		$o_indexResponse->dodajParametr("rekordy", $rekordy);		$o_indexResponse->dodajParametr('link', Core_Config::get('cms_dir') . '/' . $this->modul . '/');		$o_indexResponse->dodajParametr('komunikaty', $komunikaty);		return $o_indexResponse;	}	//============================================================================	function dodajAction(Core_Request $o_requestIn)	{		$o_indexResponse = new Core_Response();		$o_indexResponse->setModuleTemplate("form");		$r = new Model_Grupa();		$komunikaty = array();		$a_rekord   = $o_requestIn->getParametr('r');		if (is_array($a_rekord)) {			$r->fromArray($a_rekord);			$komunikaty = $r->validate();			if (count($komunikaty) == 0) {				$r->zapisz();				$this->setTemplate('komunikat');				$komunikaty[] = array('ok', 'Rekord został dodany.');			}		}		$o_indexResponse->dodajParametr('link', Core_Config::get('cms_dir') . '/' . $this->modul . '/');		$o_indexResponse->dodajParametr('link_form', Core_Config::get('cms_dir') . '/' . $this->modul . '/dodaj/');		$o_indexResponse->dodajParametr('komunikaty', $komunikaty);		$o_indexResponse->dodajParametr('r', $r);		$o_indexResponse->dodajParametr('form_nazwa', "dodaj");		return $o_indexResponse;	}	//============================================================================	function edytujAction(Core_Request $o_requestIn)	{		$o_indexResponse = new Core_Response();		$o_indexResponse->setModuleTemplate("form");		$grupa_id = (int)$o_requestIn->getParametr('id');		$r        = new Model_Grupa($grupa_id);		$komunikaty = array();		$a_rekord   = $o_requestIn->getParametr('r');		if (is_array($a_rekord)) {			$r->fromArray($a_rekord);			$komunikaty = $r->validate();			if (count($komunikaty) == 0) {				$r->zapisz();				$this->setTemplate('komunikat');				$komunikaty[] = array('ok', 'Rekord został zapisany.');			}		}		$a_uprawnienia = Model_Grupa::pobierzUprawnienia($grupa_id);		$o_indexResponse->dodajParametr('link', Core_Config::get('cms_dir') . '/' . $this->modul . '/');		$o_indexResponse->dodajParametr('link_form', Core_Config::get('cms_dir') . '/' . $this->modul . '/edytuj/');		$o_indexResponse->dodajParametr('komunikaty', $komunikaty);		$o_indexResponse->dodajParametr('uprawnienia', $a_uprawnienia);		$o_indexResponse->dodajParametr('r', $r);		$o_indexResponse->dodajParametr('form_nazwa', "edytuj");		return $o_indexResponse;	}	//============================================================================	function usunAction(Core_Request $o_requestIn)	{		$o_indexResponse = new Core_Response();		$o_indexResponse->setModuleTemplate('usun');		$komunikaty = array();		$idRekordu  = (int)$o_requestIn->getParametr('id');		if ($idRekordu > 0) {			$this->db->query('DELETE FROM administratorzy_grupy WHERE grupa_id = ' . (int)$idRekordu);			$komunikaty[] = array('ok', 'Rekord o id = ' . (int)$idRekordu . ' został usunięty.');		}		$o_indexResponse->dodajParametr('link', Core_Config::get('cms_dir') . '/' . $this->modul . '/');		$o_indexResponse->dodajParametr('link_form', '/' . $this->modul . '/dodaj/');		$o_indexResponse->dodajParametr('komunikaty', $komunikaty);		return $o_indexResponse;	}}