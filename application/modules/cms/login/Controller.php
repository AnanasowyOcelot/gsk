<?phpclass login_Controller extends Core_ModuleController{	public function __construct()	{		$this->modul = 'login';		parent::__construct();	}	public function indexAction(Core_Request $o_requestIn)	{		$o_indexResponse = new Core_Response();		$o_indexResponse->setModuleTemplate("index");		$o_indexResponse->setLayoutTemplate("loginPage");		$o_indexResponse->dodajParametr('link', '/' . $this->modul . '/');		return $o_indexResponse;	}	public function zalogujAction(Core_Request $o_requestIn)	{		$o_response = new Core_Response();		$o_response->dodajParametr('link', '/' . $this->modul . '/');		$o_response->setModuleTemplate("index");		$o_response->setLayoutTemplate("loginPage");		if (trim($o_requestIn->getParametr('login')) != "" && trim($o_requestIn->getParametr('haslo')) != "") {			$db  = Core_DB::instancja();			$sql = 'SELECT administrator_id AS id FROM administratorzy WHERE administrator_login = "' . mysql_real_escape_string($o_requestIn->getParametr('login')) . '" AND administrator_haslo = "' . mysql_real_escape_string(md5($o_requestIn->getParametr('haslo'))) . '" LIMIT 1';			$res = $db->get_row($sql);			if (count($res) != 1) {				$o_response->addError('Błędna para login/hasło');			} else {				$o_administrator = new Model_Administrator($res['id']);				if ($o_administrator->aktywny != 1) {					$o_response->addError("Twoje konto jest nieaktywne");				}				if ($o_administrator->grupa_aktywna != 1) {					$o_response->addError('Grupa, do której należysz jest nieaktywna.');				}				if (count($o_administrator->errors) == 0) {					$_SESSION['cmsAdminId'] = $res['id'];					$o_admin = new Model_Administrator();					$o_admin->pobierz($res['id']);					$_SESSION['admin_dane'] = $o_admin->imie . " " . $o_admin->nazwisko . " - " . $o_admin->grupa_nazwa;					$o_response->setHeaderParametr("", 'HTTP/1.1 301 Moved Permanently');					$o_config = new Core_Config();					$link = $o_config->get('cms_dir');					$o_response->setHeaderParametr("Location", $link);				}			}		} else {			$o_response->addError("Brak hasła i/lub loginu");		}		return $o_response;	}	public function wylogujAction(Core_Request $o_requestIn)	{		if (isset($_SESSION['cmsAdminId'])) {			$_SESSION['cmsAdminId'] = null;			session_unset();			session_destroy();			$link = Core_Config::get('cms_dir');			header("Location: $link");		}	}}